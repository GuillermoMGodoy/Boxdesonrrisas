<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Box de Sonrisas - Tortas y Postres</title>

    <!-- Estilos y Fuentes -->
    <style>
        /* --- FUENTES DE GOOGLE --- */
        @import url('https://fonts.googleapis.com/css2?family=Pacifico&family=Poppins:wght@400;600;700&display=swap');
        /* --- LIBRER√çA PARA ANIMACIONES (AOS) --- */
        @import url('https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css');

        /* --- VARIABLES DE COLOR (Basadas en tu logo) --- */
        :root {
            --color-primario: #f4a5bA;
            /* Rosa principal del logo */
            --color-secundario: #e87fa1;
            /* Un rosa un poco m√°s oscuro */
            --color-texto: #4f4f4f;
            /* Gris oscuro para texto legible */
            --color-fondo: #fff9fb;
            /* Un fondo blanco-rosado muy sutil */
            --color-blanco: #ffffff;
        }

        /* --- ESTILOS GENERALES --- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--color-fondo);
            color: var(--color-texto);
            line-height: 1.6;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 0 20px;
        }

        h1,
        h2 {
            font-family: 'Pacifico', cursive;
            color: var(--color-secundario);
            font-weight: normal;
        }

        /* --- HEADER Y LOGO --- */
        .header {
            background: var(--color-blanco);
            padding: 1rem 0;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header img.logo {
            max-width: 100px;
            height: auto;
        }

        /* --- SECCI√ìN DE BIENVENIDA --- */
        .hero {
            padding: 4rem 2rem;
            text-align: center;
            background-image: linear-gradient(to top, var(--color-fondo), var(--color-blanco));
        }

        .hero h1 {
            font-size: 3.5rem;
            margin-bottom: 0.5rem;
        }

        .hero p {
            font-size: 1.2rem;
        }

        /* --- SECCI√ìN DE PRODUCTOS --- */
        #productos {
            padding: 4rem 0;
        }

        #productos h2 {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 2.5rem;
        }

        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
        }

        .product-card {
            background: var(--color-blanco);
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .product-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 8px 30px rgba(232, 127, 161, 0.2);
        }

        .product-image-container {
            position: relative;
            width: 100%;
            height: 220px;
            /* Altura fija para todas las im√°genes */
            background-color: var(--color-blanco);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* --- CSS CORREGIDO --- */
        .product-image-container .product-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain;
            transition: opacity 0.3s ease-in-out;
            opacity: 0;
            /* Oculta por defecto */
            pointer-events: none;
            /* Evita interacciones raras con im√°genes ocultas */
        }

        .product-image-container .product-image.active {
            opacity: 1;
            /* Muestra solo la activa */
            pointer-events: auto;
        }

        /* --- FIN CSS CORREGIDO --- */

        .gallery-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background-color: rgba(255, 255, 255, 0.7);
            border: none;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            cursor: pointer;
            font-size: 20px;
            font-weight: bold;
            color: var(--color-secundario);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            /* Ocultos por defecto */
            transition: opacity 0.3s ease;
            z-index: 10;
        }

        .product-image-container:hover .gallery-nav {
            opacity: 1;
            /* Aparecen al pasar el mouse sobre la imagen */
        }

        .gallery-nav.prev {
            left: 10px;
        }

        .gallery-nav.next {
            right: 10px;
        }


        .product-info {
            padding: 1.5rem;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .product-info h3 {
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            font-size: 1.4rem;
            color: var(--color-secundario);
        }

        .product-info p {
            margin: 0.5rem 0 1rem;
            flex-grow: 1;
        }

        .flavor-selector {
            width: 100%;
            padding: 0.7rem;
            border-radius: 8px;
            border: 1px solid #ddd;
            font-family: 'Poppins', sans-serif;
            font-size: 1rem;
            margin-bottom: 1rem;
            cursor: pointer;
        }

        .btn-add-cart {
            background-image: linear-gradient(45deg, var(--color-primario), var(--color-secundario));
            color: var(--color-blanco);
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 50px;
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: block;
            text-align: center;
            text-decoration: none;
            margin-top: auto;
            /* Empuja el bot√≥n hacia abajo */
        }

        .btn-add-cart:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(232, 127, 161, 0.4);
        }

        /* --- Estilos del carrito y modales (sin cambios) --- */
        .cart-fab {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 70px;
            height: 70px;
            background-image: linear-gradient(45deg, var(--color-secundario), var(--color-primario));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            z-index: 1001;
        }

        .cart-icon {
            width: 35px;
            height: 35px;
            fill: var(--color-blanco)
        }

        #cart-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background: red;
            color: white;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: .9rem;
            font-weight: bold
        }

        .modal {
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, .5);
            display: none;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity .3s ease
        }

        .modal.active {
            display: flex;
            opacity: 1
        }

        .modal-content {
            background: var(--color-fondo);
            padding: 2rem;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            position: relative;
            transform: scale(.9);
            transition: transform .3s ease
        }

        .modal.active .modal-content {
            transform: scale(1)
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 2rem;
            color: #aaa;
            cursor: pointer;
            line-height: 1
        }

        .close-btn:hover {
            color: #555
        }

        .modal h2 {
            font-size: 2rem;
            margin-bottom: 1.5rem;
            text-align: center
        }

        #cart-items-list {
            list-style: none;
            margin-bottom: 1.5rem
        }

        #cart-items-list li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: .8rem 0;
            border-bottom: 1px solid #eee;
            font-size: 1.1rem
        }

        #empty-cart-message {
            text-align: center;
            color: #888;
            padding: 2rem 0
        }

        .remove-item-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.2rem;
            color: var(--color-secundario);
            padding: 0 5px;
        }

        .remove-item-btn:hover {
            color: red;
        }

        .btn-checkout {
            width: 100%
        }

        #checkout-form .form-group {
            margin-bottom: 1rem
        }

        #checkout-form label {
            display: block;
            margin-bottom: .5rem;
            font-weight: 600;
            color: var(--color-secundario)
        }

        #checkout-form input,
        #checkout-form select,
        #checkout-form textarea {
            width: 100%;
            padding: .8rem;
            border-radius: 8px;
            border: 1px solid #ddd;
            font-family: 'Poppins', sans-serif;
            font-size: 1rem
        }

        #checkout-form textarea {
            resize: vertical;
            min-height: 80px
        }

        .btn-whatsapp {
            width: 100%
        }

        .letter-selector-container {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .char-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            justify-content: center;
        }

        .char-btn {
            width: 40px;
            height: 40px;
            border: 1px solid var(--color-primario);
            border-radius: 8px;
            background: var(--color-blanco);
            color: var(--color-secundario);
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s;
        }

        .char-btn:hover {
            background-color: var(--color-primario);
            color: var(--color-blanco);
        }

        .letter-input-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
        }

        #letter-cake-input {
            font-size: 1.5rem;
            text-align: center;
            border-radius: 8px;
            border: 1px solid #ddd;
            padding: 0.5rem;
            width: 100%;
            max-width: 150px;
            font-family: 'Poppins', sans-serif;
        }

        .footer {
            background: var(--color-secundario);
            color: var(--color-blanco);
            text-align: center;
            padding: 2rem 0;
            margin-top: 4rem
        }

        /* --- INICIO: Estilos para Social Media en Footer --- */
        .footer-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1.5rem;
            /* Espacio entre el texto de copyright y los √≠conos */
        }

        .social-links {
            display: flex;
            gap: 1.5rem;
            /* Espacio entre los √≠conos */
        }

        .social-icon {
            position: relative;
            /* Clave para el posicionamiento del tooltip */
            display: flex;
            align-items: center;
            justify-content: center;
            width: 50px;
            height: 50px;
            background-color: var(--color-blanco);
            border-radius: 50%;
            /* Hace los √≠conos circulares */
            transition: all 0.3s ease-out;
        }

        .social-icon img {
            width: 28px;
            height: 28px;
            transition: transform 0.3s ease;
        }

        /* --- El efecto "Lift & Glow" al pasar el cursor --- */
        .social-icon:hover {
            transform: translateY(-8px);
            /* Eleva el √≠cono */
            box-shadow: 0 10px 20px rgba(232, 127, 161, 0.4);
            /* Sombra rosada de tu marca */
        }

        .social-icon:hover img {
            transform: scale(1.1);
            /* Agranda sutilmente la imagen de adentro */
        }

        /* --- Estilo del Tooltip Interactivo --- */
        .tooltip {
            position: absolute;
            bottom: 125%;
            /* Se posiciona arriba del √≠cono */
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--color-texto);
            color: var(--color-blanco);
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 600;
            white-space: nowrap;
            /* Evita que el texto se parta en dos l√≠neas */

            /* Oculto por defecto con una transici√≥n suave */
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        /* Flecha del Tooltip (hecha con CSS) */
        .tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border-width: 5px;
            border-style: solid;
            border-color: var(--color-texto) transparent transparent transparent;
        }

        /* --- Muestra el tooltip al pasar el cursor --- */
        .social-icon:hover .tooltip {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(-5px);
            /* Se desplaza un poco hacia arriba */
        }

        /* --- FIN: Estilos para Social Media --- */
    </style>
</head>

<body>

    <header class="header">
        <img src="./img/logo.png" alt="Logo Box de Sonrisas" class="logo">
    </header>

    <main>
        <section class="hero">
            <div class="container">
                <h1>Tu Dosis de Alegr√≠a</h1>
                <p>Las tortas y postres m√°s deliciosos, hechos con amor para crear sonrisas.</p>
            </div>
        </section>

        <section id="productos">
            <div class="container">
                <h2>Nuestras Creaciones</h2>
                <div class="product-grid" id="product-list">
                    <!-- PRODUCTOS EST√ÅTICOS CORREGIDOS -->
                    <div class="product-card" data-aos="fade-up">
                        <div class="product-image-container">
                            <!-- Imagen de portada, activa por defecto -->
                            <img src="./img/shots portada.jpeg" alt="Shots Dulces" class="product-image active"
                                data-flavor-img="portada">

                            <!-- Im√°genes de cada sabor, ocultas al inicio -->
                            <img src="./img/shot chocotorta.png" alt="Shot Chocotorta" class="product-image"
                                data-flavor-img="Chocotorta">
                            <img src="./img/Shot Lemon Pie.jpeg" alt="Shot Lemon Pie" class="product-image"
                                data-flavor-img="Lemon Pie">
                            <img src="./img/shot oreo.jpeg" alt="Shot Oreo" class="product-image"
                                data-flavor-img="Oreo">
                            <img src="./img/shot tiramisu.jpeg" alt="Shot Tiramisu" class="product-image"
                                data-flavor-img="Tiramis√∫">
                        </div>
                        <div class="product-info">
                            <h3>Shots Dulces</h3>
                            <p>Vasitos de 200cc llenos de sabor. Elige tu favorito para endulzar cualquier momento.</p>
                            <!-- El select ahora usa 'data-target-img' para apuntar a la imagen -->
                            <select class="flavor-selector">
                                <!-- La primera opci√≥n apunta a la imagen de portada -->
                                <option value="shot-portada" data-target-img="portada" selected>Elige un sabor...
                                </option>
                                <option value="shot-chocotorta" data-target-img="Chocotorta">Chocotorta</option>
                                <option value="shot-lemonpie" data-target-img="Lemon Pie">Lemon Pie</option>
                                <option value="shot-oreo" data-target-img="Oreo">Oreo</option>
                                <option value="shot-tiramisu" data-target-img="Tiramis√∫">Tiramis√∫</option>
                            </select>
                            <button class="btn-add-cart" data-id="100" data-name="Shot Dulce">Agregar al Pedido</button>
                        </div>
                    </div>

                    <div class="product-card" data-aos="fade-up">
                        <div class="product-image-container">
                            <!-- Imagen de portada -->
                            <img src="./img/torta brownie.png" alt="Torta Brownie" class="product-image active"
                                data-flavor-img="Clasica">
                            <!-- Im√°genes de las otras variedades -->
                            <img src="./img/torta brownie oreo.png" alt="Torta Brownie Oreo" class="product-image"
                                data-flavor-img="Oreo">
                            <img src="./img/torta brownie frutillas.png" alt="Torta Brownie Frutillas"
                                class="product-image" data-flavor-img="Frutillas">
                        </div>
                        <div class="product-info">
                            <h3>Torta Brownie</h3>
                            <p>Deliciosa base de brownie con dulce de leche y crema. Eleg√≠ tu versi√≥n favorita.</p>
                            <select class="flavor-selector">
                                <option value="brownie-clasica" data-target-img="Clasica" selected>Torta brownie, con
                                    ddl y crema</option>
                                <option value="brownie-oreo" data-target-img="Oreo">Torta brownie, con ddl, crema y oreo
                                </option>
                                <option value="brownie-frutillas" data-target-img="Frutillas">Torta brownie, con ddl,
                                    crema y frutillas</option>
                            </select>
                            <button class="btn-add-cart" data-id="101" data-name="Torta Brownie">Agregar al
                                Pedido</button>
                        </div>
                    </div>

                    <!-- Los productos din√°micos se generar√°n aqu√≠ con JS -->
                </div>
            </div>
        </section>
    </main>

    <!-- FAB y Modales -->
    <div class="cart-fab" id="cart-fab">
        <svg class="cart-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512">
            <path
                d="M0 24C0 10.7 10.7 0 24 0H69.5c22 0 41.5 12.8 50.6 32h411c26.3 0 45.5 25 38.6 50.4l-41 152.3c-8.5 31.4-37 53.3-69.5 53.3H170.7l5.4 28.5c2.2 11.3 12.1 19.5 23.6 19.5H488c13.3 0 24 10.7 24 24s-10.7 24-24 24H199.7c-34.6 0-64.3-24.6-70.7-58.5L77.4 54.5c-.7-3.8-4-6.5-7.9-6.5H24C10.7 48 0 37.3 0 24zM128 464a48 48 0 1 1 96 0 48 48 0 1 1 -96 0zm336-48a48 48 0 1 1 0 96 48 48 0 1 1 0-96z" />
        </svg>
        <span id="cart-count">0</span>
    </div>
    <div id="cart-modal" class="modal">
        <div class="modal-content"><span class="close-btn" id="close-cart-btn">√ó</span>
            <h2>Mi Pedido</h2>
            <ul id="cart-items-list"></ul>
            <p id="empty-cart-message">Tu carrito de sonrisas est√° vac√≠o.</p>
            <button class="btn-add-cart btn-checkout" id="checkout-btn" style="display: none;">Continuar con el
                Pedido</button>
        </div>
    </div>

    <div id="checkout-modal" class="modal">
        <div class="modal-content"><span class="close-btn" id="close-checkout-btn">√ó</span>
            <h2>Informaci√≥n para tu Pedido</h2>
            <form id="checkout-form">
                <div class="form-group"><label for="nombre">Nombre y Apellido</label><input type="text" id="nombre"
                        name="nombre" required></div>
                <div class="form-group">
                    <label>Forma de Entrega</label>
                    <input type="text" value="Retiro por el local" readonly style="background: #f0f0f0;">
                </div>
                <div class="form-group"><label for="pago">¬øC√≥mo pagas?</label><select id="pago" name="pago" required>
                        <option value="Transferencia">Transferencia</option>
                        <option value="Efectivo">Efectivo</option>
                    </select></div>
                <div class="form-group"><label for="anotaciones">Anotaciones (ej: alguna alergia, fecha de retiro,
                        etc.)</label><textarea id="anotaciones" name="anotaciones"></textarea></div><button
                    type="submit" class="btn-add-cart btn-whatsapp">Enviar Pedido por WhatsApp</button>
            </form>
        </div>
    </div>

    <div id="letter-cake-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn" id="close-letter-cake-btn">√ó</span>
            <h2>Personaliza tu Torta</h2>
            <div class="letter-selector-container">
                <div class="letter-input-group">
                    <label for="letter-cake-input">Letra(s) o N√∫mero(s) seleccionados:</label>
                    <input type="text" id="letter-cake-input" placeholder="Ej: A, 18, TE AMO">
                </div>
                <h4>Letras</h4>
                <div class="char-selector" id="letter-selector"></div>
                <h4>N√∫meros</h4>
                <div class="char-selector" id="number-selector"></div>
                <button class="btn-add-cart" id="add-letter-cake-to-cart">A√±adir al Pedido</button>
            </div>
        </div>
    </div>

    <!-- REEMPLAZA TU FOOTER ACTUAL CON ESTE -->
    <footer class="footer">
        <div class="container footer-content">

            <!-- Div para los logos de redes sociales -->
            <div class="social-links">
                <!-- √çcono de Instagram -->
                <a href="https://www.instagram.com/boxdesonrisas/" class="social-icon" target="_blank"
                    rel="noopener noreferrer" aria-label="S√≠guenos en Instagram">
                    <!-- 
                        !!! IMPORTANTE !!!
                        REEMPLAZA LA URL DE ABAJO POR TU ENLACE DE INSTAGRAM 
                        Y la imagen por tu logo de Instagram
                    -->
                    <img src="./img/redes/ig.png" alt="Instagram">
                    <span class="tooltip">S√≠guenos</span>
                </a>
               <div class="footer-info">
                    <p>üìç <a href="https://www.google.com/maps?q=Av+Balbin+3638,+San+Miguel,+Buenos+Aires"
                            target="_blank" rel="noopener noreferrer">
                            Retiros por Av Balbin 3638, San Miguel, Buenos Aires
                        </a></p>
                    <p>üïí Pedidos con 48hs de anticipaci√≥n</p>
                </div>


                <!-- Texto de Copyright -->

            </div>
            <p>¬© 2025 Box de Sonrisas. Creado con ‚ù§Ô∏è por G & G Soluciones Digitales.</p>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js"></script>

    <!-- SCRIPT CORREGIDO Y COMPLETO -->
    <!-- SCRIPT CORREGIDO Y COMPLETO -->
    <script>
        AOS.init({ duration: 800, once: true });

        document.addEventListener('DOMContentLoaded', () => {
            const whatsappNumber = '5491136423263';

            const productosDinamicos = [
                { id: 1, nombre: 'Chocotorta', descripcion: 'La cl√°sica y deliciosa chocotorta, hecha con amor...', imagenes: ['./img/Chocotorta.jpeg', './img/Chocotorta2.jpeg'] },
                { id: 2, nombre: 'Brownie Solo', descripcion: 'Brownie cl√°sico, h√∫medo y lleno de sabor.', imagenes: ['./img/brownie.png'] },
                { id: 3, nombre: 'Box 8 de Brownies', descripcion: 'Caja con 8 brownies cl√°sicos, perfectos para compartir.', imagenes: ['./img/box 8 brownies.png'] },
                { id: 4, nombre: 'Tarta Banana Split', descripcion: 'Tarta con base crocante, banana, dulce de leche y crema.', imagenes: ['./img/Tarta banana split. Banana, ddl y crema.png'] },
                { id: 5, nombre: 'Tarta de manzanas', descripcion: 'Tarta casera con manzanas frescas y un toque de canela.', imagenes: ['./img/tarta de manzana.png', './img/tarta de manzana 2.png'] },
                { id: 6, nombre: 'Cheesecake con frutos rojos', descripcion: 'Suave cheesecake con cobertura de frutos rojos.', imagenes: ['./img/cheesecake c frutos rojos.png'] },
                { id: 7, nombre: 'Letter/Number Cake', special: 'letter-cake', descripcion: 'Torta en forma de letra o n√∫mero. ¬°Personal√≠zala!', imagenes: ['./img/Letter number cake.png'] },
            ];

            const productList = document.getElementById('product-list');
            const cartFab = document.getElementById('cart-fab');
            const cartCount = document.getElementById('cart-count');
            const cartModal = document.getElementById('cart-modal');
            const closeCartBtn = document.getElementById('close-cart-btn');
            const cartItemsList = document.getElementById('cart-items-list');
            const emptyCartMessage = document.getElementById('empty-cart-message');
            const checkoutBtn = document.getElementById('checkout-btn');
            const checkoutModal = document.getElementById('checkout-modal');
            const closeCheckoutBtn = document.getElementById('close-checkout-btn');
            const checkoutForm = document.getElementById('checkout-form');

            const letterCakeModal = document.getElementById('letter-cake-modal');
            const closeLetterCakeBtn = document.getElementById('close-letter-cake-btn');
            const letterSelector = document.getElementById('letter-selector');
            const numberSelector = document.getElementById('number-selector');
            const letterCakeInput = document.getElementById('letter-cake-input');
            const addLetterCakeToCartBtn = document.getElementById('add-letter-cake-to-cart');

            let cart = [];

            // --- FUNCI√ìN CLAVE: Detecta si el usuario est√° en un dispositivo m√≥vil ---
            function isMobileDevice() {
                // Usamos una expresi√≥n regular para buscar palabras clave de m√≥viles en el User Agent
                return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            }

            function setupLetterCakeModal() {
                const letras = "ABCDEFGHIJKLMN√ëOPQRSTUVWXYZ".split('');
                const numeros = "0123456789".split('');
                letterSelector.innerHTML = letras.map(l => `<button class="char-btn">${l}</button>`).join('');
                numberSelector.innerHTML = numeros.map(n => `<button class="char-btn">${n}</button>`).join('');
                letterCakeModal.addEventListener('click', e => {
                    if (e.target.classList.contains('char-btn')) {
                        if (letterCakeInput.value.length < 10) {
                            letterCakeInput.value += e.target.textContent;
                        }
                    }
                });
                addLetterCakeToCartBtn.addEventListener('click', () => {
                    const customText = letterCakeInput.value.trim().toUpperCase();
                    if (customText === "") {
                        alert("Por favor, ingresa al menos una letra o n√∫mero.");
                        return;
                    }
                    const uniqueId = `7-${customText}`;
                    addToCart({ id: uniqueId, nombre: `Letter/Number Cake: '${customText}'` });
                    letterCakeInput.value = '';
                    letterCakeModal.classList.remove('active');
                });
            }

            function renderDynamicProducts() {
                productosDinamicos.forEach(producto => {
                    const productCard = document.createElement('div');
                    productCard.className = 'product-card dynamic';
                    productCard.setAttribute('data-aos', 'fade-up');
                    const imagesHTML = producto.imagenes.map((img, index) =>
                        `<img src="${img}" alt="${producto.nombre}" class="product-image ${index === 0 ? 'active' : ''}">`
                    ).join('');
                    const navButtonsHTML = producto.imagenes.length > 1 && !producto.special ? `
                        <button class="gallery-nav prev"><</button>
                        <button class="gallery-nav next">></button>
                    ` : '';
                    const addButtonData = producto.special
                        ? `data-special="${producto.special}"`
                        : `data-id="${producto.id}"`;
                    productCard.innerHTML = `
                        <div class="product-image-container">
                            ${imagesHTML}
                            ${navButtonsHTML}
                        </div>
                        <div class="product-info">
                            <h3>${producto.nombre}</h3>
                            <p>${producto.descripcion}</p>
                            <button class="btn-add-cart" ${addButtonData} data-name="${producto.nombre}">Agregar al Pedido</button>
                        </div>`;
                    productList.appendChild(productCard);
                });
            }

            function addToCart(product) {
                const existingItem = cart.find(item => item.id === product.id);
                if (existingItem) {
                    existingItem.quantity++;
                } else {
                    cart.push({ ...product, quantity: 1 });
                }
                updateCartView();
            }

            function updateCartView() {
                cartItemsList.innerHTML = '';
                const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
                emptyCartMessage.style.display = cart.length === 0 ? 'block' : 'none';
                checkoutBtn.style.display = cart.length === 0 ? 'none' : 'block';
                cart.forEach((item) => {
                    const li = document.createElement('li');
                    li.innerHTML = `
                        <span>${item.nombre} (x${item.quantity})</span>
                        <button class="remove-item-btn" data-id="${item.id}" title="Eliminar producto">üóëÔ∏è</button>
                    `;
                    cartItemsList.appendChild(li);
                });
                cartCount.textContent = totalItems;
            }

            productList.addEventListener('click', e => {
                const button = e.target.closest('.btn-add-cart');
                const navButton = e.target.closest('.gallery-nav');

                if (button) {
                    if (button.dataset.special === 'letter-cake') {
                        letterCakeModal.classList.add('active');
                        return;
                    }
                    let baseId = button.dataset.id;
                    let productName = button.dataset.name;
                    let finalId = baseId;
                    const selector = button.closest('.product-info').querySelector('.flavor-selector');
                    if (selector) {
                        const selectedOption = selector.options[selector.selectedIndex];
                        const flavorText = selectedOption.text;
                        if (selectedOption.value === "shot-portada") {
                            alert("Por favor, elige un sabor para agregarlo al pedido.");
                            return;
                        }
                        finalId = selectedOption.value;
                        productName = baseId === '100' ? `Shot de ${flavorText}` : flavorText;
                    }
                    addToCart({ id: finalId, nombre: productName });
                }

                if (navButton) {
                    const gallery = navButton.closest('.product-image-container');
                    const images = gallery.querySelectorAll('.product-image');
                    const activeImage = gallery.querySelector('.product-image.active');
                    let currentIndex = Array.from(images).indexOf(activeImage);
                    let nextIndex = navButton.classList.contains('next') ? currentIndex + 1 : currentIndex - 1;
                    if (nextIndex >= images.length) nextIndex = 0;
                    if (nextIndex < 0) nextIndex = images.length - 1;
                    activeImage.classList.remove('active');
                    images[nextIndex].classList.add('active');
                }
            });

            document.querySelectorAll('.flavor-selector').forEach(selector => {
                selector.addEventListener('change', (e) => {
                    const selectedOption = e.target.options[e.target.selectedIndex];
                    const targetImageName = selectedOption.dataset.targetImg;
                    if (!targetImageName) return;
                    const imageContainer = e.target.closest('.product-card').querySelector('.product-image-container');
                    imageContainer.querySelectorAll('.product-image').forEach(img => img.classList.remove('active'));
                    const imageToShow = imageContainer.querySelector(`.product-image[data-flavor-img="${targetImageName}"]`);
                    if (imageToShow) {
                        imageToShow.classList.add('active');
                    }
                });
            });

            cartItemsList.addEventListener('click', e => {
                const removeButton = e.target.closest('.remove-item-btn');
                if (removeButton) {
                    const itemId = removeButton.dataset.id;
                    cart = cart.filter(item => item.id.toString() !== itemId.toString());
                    updateCartView();
                }
            });

            cartFab.addEventListener('click', () => cartModal.classList.add('active'));
            closeCartBtn.addEventListener('click', () => cartModal.classList.remove('active'));
            checkoutBtn.addEventListener('click', () => {
                cartModal.classList.remove('active');
                checkoutModal.classList.add('active');
            });
            closeCheckoutBtn.addEventListener('click', () => checkoutModal.classList.remove('active'));
            closeLetterCakeBtn.addEventListener('click', () => letterCakeModal.classList.remove('active'));
            window.addEventListener('click', (e) => {
                if (e.target == cartModal) cartModal.classList.remove('active');
                if (e.target == checkoutModal) checkoutModal.classList.remove('active');
                if (e.target == letterCakeModal) letterCakeModal.classList.remove('active');
            });

            // --- BLOQUE DE ENV√çO DEL FORMULARIO CON LA NUEVA L√ìGICA ---
            checkoutForm.addEventListener('submit', (e) => {
                e.preventDefault();

                try {
                    const nombre = document.getElementById('nombre').value;
                    const pago = document.getElementById('pago').value;
                    let anotaciones = document.getElementById('anotaciones').value;

                    if (cart.length === 0) {
                        alert("Tu carrito est√° vac√≠o. Agrega productos antes de enviar el pedido.");
                        return;
                    }

                    let mensaje = `¬°Hola Box de Sonrisas! üòä\nQuisiera hacer el siguiente pedido:\n\n`;
                    cart.forEach(item => {
                        mensaje += `*‚Ä¢ ${item.nombre} (x${item.quantity})*\n`;
                    });
                    mensaje += `\n*Mis Datos:*\n*Nombre:* ${nombre}\n*Forma de Entrega:* Retiro por el local\n*Forma de Pago:* ${pago}\n`;
                    if (anotaciones.trim() !== '') {
                        mensaje += `*Anotaciones:* ${anotaciones}\n`;
                    }
                    mensaje += `\n¬°Muchas gracias!`;

                    const mensajeCodificado = encodeURIComponent(mensaje);
                    let whatsappURL;

                    // Decidimos qu√© URL usar bas√°ndonos en el tipo de dispositivo
                    if (isMobileDevice()) {
                        // Es un celular o tablet: abrir la app nativa
                        whatsappURL = `https://wa.me/${whatsappNumber}?text=${mensajeCodificado}`;
                    } else {
                        // Es una computadora: forzar la apertura de WhatsApp Web
                        whatsappURL = `https://web.whatsapp.com/send?phone=${whatsappNumber}&text=${mensajeCodificado}`;
                    }

                    const newWindow = window.open(whatsappURL, '_blank');

                    if (!newWindow || newWindow.closed || typeof newWindow.closed === 'undefined') {
                        alert("El navegador bloque√≥ la ventana de WhatsApp. Por favor, habilita las ventanas emergentes para este sitio e int√©ntalo de nuevo.");
                    }
                } catch (error) {
                    console.error("Ocurri√≥ un error al procesar el pedido:", error);
                    alert("Hubo un error inesperado al preparar tu pedido. Por favor, intenta de nuevo.");
                }
            });

            renderDynamicProducts();
            setupLetterCakeModal();
            updateCartView();
        });
    </script>
</body>

</html>
